<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NEML2: StaticHybridScheduler Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams','[tex]/physics','[tex]/boldsymbol']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams','physics','boldsymbol']
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">NEML2<span id="projectnumber">&#160;2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classneml2_1_1StaticHybridScheduler.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classneml2_1_1StaticHybridScheduler-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">StaticHybridScheduler Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>A scheduler for multiple devices with static priority management.  
 <a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A scheduler for multiple devices with static priority management. </p>
<p>The devices could have different priority, batch sizes, and capacities. The priorities are determined at construction time and remain unchanged throughout the lifetime of the scheduler. </p>
</div>
<p><code>#include &lt;<a class="el" href="StaticHybridScheduler_8h_source.html">StaticHybridScheduler.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for StaticHybridScheduler:</div>
<div class="dyncontent">
<div class="center"><img src="classneml2_1_1StaticHybridScheduler__inherit__graph.png" border="0" usemap="#aStaticHybridScheduler_inherit__map" alt="Inheritance graph"/></div>
<map name="aStaticHybridScheduler_inherit__map" id="aStaticHybridScheduler_inherit__map">
<area shape="rect" title="A scheduler for multiple devices with static priority management." alt="" coords="5,79,172,104"/>
<area shape="rect" href="classneml2_1_1WorkScheduler.html" title="Scheduler for work dispatching." alt="" coords="29,5,148,31"/>
<area shape="poly" title=" " alt="" coords="91,44,91,79,86,79,86,44"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structneml2_1_1StaticHybridScheduler_1_1DeviceStatus.html">DeviceStatus</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:adfba38305548987cfdc51aa277f28324" id="r_adfba38305548987cfdc51aa277f28324"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adfba38305548987cfdc51aa277f28324">StaticHybridScheduler</a> (<a class="el" href="classneml2_1_1CrossRef.html">const</a> std::vector&lt; torch::Device &gt; &amp;<a class="el" href="classneml2_1_1CrossRef.html">device_list</a>, <a class="el" href="classneml2_1_1CrossRef.html">const</a> std::vector&lt; std::size_t &gt; &amp;batch_sizes, <a class="el" href="classneml2_1_1CrossRef.html">const</a> std::vector&lt; std::size_t &gt; &amp;<a class="el" href="classneml2_1_1CrossRef.html">capacities</a>={}, <a class="el" href="classneml2_1_1CrossRef.html">const</a> std::vector&lt; <a class="el" href="classneml2_1_1CrossRef.html">double</a> &gt; &amp;<a class="el" href="classneml2_1_1CrossRef.html">priorities</a>={})</td></tr>
<tr class="separator:adfba38305548987cfdc51aa277f28324"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac96a64fe4ae78607c46c2a8fb6e52b73" id="r_ac96a64fe4ae78607c46c2a8fb6e52b73"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classneml2_1_1CrossRef.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac96a64fe4ae78607c46c2a8fb6e52b73">schedule_work</a> (torch::Device &amp;, std::size_t &amp;) <a class="el" href="classneml2_1_1CrossRef.html">const</a> <a class="el" href="classneml2_1_1CrossRef.html">override</a></td></tr>
<tr class="memdesc:ac96a64fe4ae78607c46c2a8fb6e52b73"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pick the next device to dispatch work to.  <br /></td></tr>
<tr class="separator:ac96a64fe4ae78607c46c2a8fb6e52b73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa2b8c676b0343981939a0f07be8f918" id="r_afa2b8c676b0343981939a0f07be8f918"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classneml2_1_1CrossRef.html">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afa2b8c676b0343981939a0f07be8f918">set_availability_calculator</a> (std::function&lt; <a class="el" href="classneml2_1_1CrossRef.html">double</a>(<a class="el" href="classneml2_1_1CrossRef.html">const</a> <a class="el" href="structneml2_1_1StaticHybridScheduler_1_1DeviceStatus.html">DeviceStatus</a> &amp;)&gt;)</td></tr>
<tr class="memdesc:afa2b8c676b0343981939a0f07be8f918"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set a custom availability calculator.  <br /></td></tr>
<tr class="separator:afa2b8c676b0343981939a0f07be8f918"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad77ed57108c32413120fbe7046178d6e" id="r_ad77ed57108c32413120fbe7046178d6e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classneml2_1_1CrossRef.html">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad77ed57108c32413120fbe7046178d6e">dispatched_work</a> (torch::Device, std::size_t) <a class="el" href="classneml2_1_1CrossRef.html">override</a></td></tr>
<tr class="memdesc:ad77ed57108c32413120fbe7046178d6e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the schedule with the dispatch of the last batch.  <br /></td></tr>
<tr class="separator:ad77ed57108c32413120fbe7046178d6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86a5318720d677f37dea001ef59decb0" id="r_a86a5318720d677f37dea001ef59decb0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classneml2_1_1CrossRef.html">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a86a5318720d677f37dea001ef59decb0">completed_work</a> (torch::Device, std::size_t) <a class="el" href="classneml2_1_1CrossRef.html">override</a></td></tr>
<tr class="memdesc:a86a5318720d677f37dea001ef59decb0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the schedule with the completion of the last batch.  <br /></td></tr>
<tr class="separator:a86a5318720d677f37dea001ef59decb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d7dcc0907568527948bd2818cf7abaf" id="r_a9d7dcc0907568527948bd2818cf7abaf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classneml2_1_1CrossRef.html">const</a> std::vector&lt; <a class="el" href="structneml2_1_1StaticHybridScheduler_1_1DeviceStatus.html">DeviceStatus</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9d7dcc0907568527948bd2818cf7abaf">status</a> () <a class="el" href="classneml2_1_1CrossRef.html">const</a></td></tr>
<tr class="separator:a9d7dcc0907568527948bd2818cf7abaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="adfba38305548987cfdc51aa277f28324" name="adfba38305548987cfdc51aa277f28324"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfba38305548987cfdc51aa277f28324">&#9670;&#160;</a></span>StaticHybridScheduler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classneml2_1_1StaticHybridScheduler.html">StaticHybridScheduler</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classneml2_1_1CrossRef.html">const</a> std::vector&lt; torch::Device &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>device_list</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classneml2_1_1CrossRef.html">const</a> std::vector&lt; std::size_t &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>batch_sizes</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classneml2_1_1CrossRef.html">const</a> std::vector&lt; std::size_t &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>capacities</em><span class="paramdefsep"> = </span><span class="paramdefval">{}</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classneml2_1_1CrossRef.html">const</a> std::vector&lt; <a class="el" href="classneml2_1_1CrossRef.html">double</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>priorities</em><span class="paramdefsep"> = </span><span class="paramdefval">{}</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The constructor takes a device list, along with the batch sizes, capacities, and priorities for each device.</p>
<p>The device list should be unique and non-empty. torch::kCPU can appear at most once. When multiple cuda devices are present, each of them must correspond to a specific device ID.</p>
<p>One or more batch size should be provided. If the number of batch sizes is one, the same batch size is associated with all devices. Otherwise, the number of batch sizes should match the number of devices.</p>
<p>Similarly, zero or more capacities should be provided. If the capacity list is empty, the default capacity is infinity (i.e., std::numeric_limits&lt;std::size_t&gt;::max()) for all devices; if the number of capacities is one, the same capacity is associated with all devices; otherwise, the number of capacities should match the number of devices.</p>
<p>An optional list of priorities can be provided. The number of priorities should match the number of devices. If no priorities are provided, all devices have the same priority. Note that this dispatcher chooses the device to dispatch not only based on the priority but also based on the availability of the device. See next() for more details.</p>
<dl class="section note"><dt>Note</dt><dd>For developers, below is a summary of the construct of torch::Device: torch::Device represents a compute device on which a tensor is located. A device is uniquely identified by a type, which specifies the type of machine it is (e.g. CPU or CUDA GPU), and a device index or ordinal, which identifies the specific compute device when there is more than one of a certain type. The device index is optional, and in its defaulted state represents (abstractly) "the current device". Further, there are two constraints on the value of the device index, if one is explicitly stored:<ol type="1">
<li>A negative index represents the current device, a non-negative index represents a specific, concrete device,</li>
<li>When the device type is CPU, the device index must be zero. </li>
</ol>
</dd></dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a86a5318720d677f37dea001ef59decb0" name="a86a5318720d677f37dea001ef59decb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86a5318720d677f37dea001ef59decb0">&#9670;&#160;</a></span>completed_work()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classneml2_1_1CrossRef.html">void</a> completed_work </td>
          <td>(</td>
          <td class="paramtype">torch::Device</td>          <td class="paramname"><span class="paramname">, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::size_t</td>          <td class="paramname"><span class="paramname"></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Update the schedule with the completion of the last batch. </p>

<p>Implements <a class="el" href="classneml2_1_1WorkScheduler.html#a89bdd229c3adc553afe2238a5a9c10dc">WorkScheduler</a>.</p>

</div>
</div>
<a id="ad77ed57108c32413120fbe7046178d6e" name="ad77ed57108c32413120fbe7046178d6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad77ed57108c32413120fbe7046178d6e">&#9670;&#160;</a></span>dispatched_work()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classneml2_1_1CrossRef.html">void</a> dispatched_work </td>
          <td>(</td>
          <td class="paramtype">torch::Device</td>          <td class="paramname"><span class="paramname">, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::size_t</td>          <td class="paramname"><span class="paramname"></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Update the schedule with the dispatch of the last batch. </p>

<p>Implements <a class="el" href="classneml2_1_1WorkScheduler.html#a9bdd7a8192f5eee5c4e4113b385be26b">WorkScheduler</a>.</p>

</div>
</div>
<a id="ac96a64fe4ae78607c46c2a8fb6e52b73" name="ac96a64fe4ae78607c46c2a8fb6e52b73"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac96a64fe4ae78607c46c2a8fb6e52b73">&#9670;&#160;</a></span>schedule_work()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classneml2_1_1CrossRef.html">bool</a> schedule_work </td>
          <td>(</td>
          <td class="paramtype">torch::Device &amp;</td>          <td class="paramname"><span class="paramname"><em>device</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::size_t &amp;</td>          <td class="paramname"><span class="paramname"><em>n</em></span>&#160;) const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Pick the next device to dispatch work to. </p>
<p>The function returns the device and the number of batches to dispatch. The device is chosen based on the availability of the available devices. A device is said to be available if (load + batch_size) &lt;= capacity. If multiple devices are available, the device with the highest availability will be chosen.</p>
<p>By default, the availability is the device's priority, a custom function can be set using <a class="el" href="#afa2b8c676b0343981939a0f07be8f918" title="Set a custom availability calculator.">set_availability_calculator()</a>. </p>

<p>Implements <a class="el" href="classneml2_1_1WorkScheduler.html#a876f741cc8ecbc458a618f9d36476254">WorkScheduler</a>.</p>

</div>
</div>
<a id="afa2b8c676b0343981939a0f07be8f918" name="afa2b8c676b0343981939a0f07be8f918"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa2b8c676b0343981939a0f07be8f918">&#9670;&#160;</a></span>set_availability_calculator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classneml2_1_1CrossRef.html">void</a> set_availability_calculator </td>
          <td>(</td>
          <td class="paramtype">std::function&lt; <a class="el" href="classneml2_1_1CrossRef.html">double</a>(<a class="el" href="classneml2_1_1CrossRef.html">const</a> <a class="el" href="structneml2_1_1StaticHybridScheduler_1_1DeviceStatus.html">DeviceStatus</a> &amp;)&gt;</td>          <td class="paramname"><span class="paramname"><em>f</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set a custom availability calculator. </p>

</div>
</div>
<a id="a9d7dcc0907568527948bd2818cf7abaf" name="a9d7dcc0907568527948bd2818cf7abaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d7dcc0907568527948bd2818cf7abaf">&#9670;&#160;</a></span>status()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classneml2_1_1CrossRef.html">const</a> std::vector&lt; <a class="el" href="structneml2_1_1StaticHybridScheduler_1_1DeviceStatus.html">DeviceStatus</a> &gt; &amp; status </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceneml2.html">neml2</a></li><li class="navelem"><a class="el" href="classneml2_1_1StaticHybridScheduler.html">StaticHybridScheduler</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
